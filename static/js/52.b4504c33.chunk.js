"use strict";(self.webpackChunkstockfish_web=self.webpackChunkstockfish_web||[]).push([[52],{52:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var i=t(371);const n="AnalysisBoard_AnalysisBoard__5GhdZ",a="AnalysisBoard_chessboardWrapper__AphH8",o="AnalysisBoard_buttons__WjXZa",c="AnalysisBoard_bestLine__9V1IQ";var l=t(43),r=t(403),h=t(629),d=t.n(h),u=t(445),A=t(846),m=t(147),p=t(935),g=t(801),k=t(579);const v={skill:20,depth:245,thinkTime:1e4},C=e=>{let{className:s,defaultPosition:t}=e;const h=(0,l.useMemo)((()=>new(d())),[]),C=(0,l.useRef)(null),[f,w]=(0,l.useState)(t||h.fen()),[x,E]=(0,l.useState)(0),[S,_]=(0,l.useState)(10),[j,y]=(0,l.useState)([]),[b,R]=(0,l.useState)(null),[I,M]=(0,l.useState)("white");(0,l.useEffect)((()=>{C.current&&C.current.terminate();const e=new r.A;C.current=e;const s=v;return e.setSkillLevel(s.skill),e.setDepth(s.depth),e.setThinkTime(s.thinkTime),s.elo&&e.setLimitStrength(!0,s.elo),s.threads&&e.setThreads(s.threads),s.multiPV&&e.setMultiPV(s.multiPV),F(),()=>{e.terminate(),C.current=null}}),[]);const N=e=>{if(!C.current)return;const{depth:s,positionEvaluation:t,possibleMate:i,pv:n}=e;s&&s<10||(t&&E(("w"===h.turn()?1:-1)*Number(t)/100),i&&R(i),s&&_(s),n&&y(n))},F=async()=>{const e=C.current;if(e){e.addMessageListener(N),console.log("\u0417\u0430\u043f\u0440\u043e\u0441 \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u0445\u043e\u0434\u0430\u2026");try{await e.evaluatePosition(h.fen())}catch(s){throw e.removeMessageListener(N),s}}};const L=j[0],[P,T]=(0,l.useState)(!1),B=(0,l.useCallback)((()=>{T(!P)}),[P]);return(0,k.jsxs)("div",{className:(0,i.x)(n,{},[s]),children:[(0,k.jsxs)("div",{className:a,children:[(0,k.jsxs)("h4",{children:["\u041e\u0446\u0435\u043d\u043a\u0430 \u043f\u043e\u0437\u0438\u0446\u0438\u0438:"," ",b?"#".concat(b):x.toFixed(4),"; ","\u0413\u043b\u0443\u0431\u0438\u043d\u0430: ",S]}),(0,k.jsxs)("h5",{className:c,children:["\u041b\u0443\u0447\u0448\u0430\u044f \u043b\u0438\u043d\u0438\u044f: ",(0,k.jsx)("i",{children:j.slice(0,10).join(" ")})," ..."]}),(0,k.jsx)(p.o,{fenPosition:f,onChange:e=>{const{valid:s}=h.validate_fen(e);s&&(h.load(e),w(h.fen()),y([]),R(null),_(null),F())}}),(0,k.jsx)(A.Ve,{id:"AnalysisBoard",position:f,onPieceDrop:function(e,s,t){const i=function(e){const s=h.move(e);return w(h.fen()),null!==s&&(h.game_over()||h.in_draw()?(m.R.checkmateSound.play(),T(!0),!1):h.in_check()?(m.R.checkSound.play(),!0):"O-O-O"===s.san||"O-O"===s.san?(m.R.castlingSound.play(),!0):s.captured?(m.R.captureSound.play(),!0):(m.R.moveSound.play(),!0))}({from:e,to:s,promotion:t[1].toLowerCase()});return R(null),y([]),i&&F(),!0},customBoardStyle:{borderRadius:"4px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},customArrows:L?[[L.substring(0,2),L.substring(2,4),"rgb(0, 128, 0)"]]:void 0,boardOrientation:I}),(0,k.jsxs)("div",{className:o,children:[(0,k.jsx)(u.$n,{theme:u.Ox.CLASSIC,onClick:()=>{R(null),y([]),h.reset(),w(h.fen()),F()},children:"\u041d\u0430\u0447\u0430\u043b\u044c\u043d\u0430\u044f \u043f\u043e\u0437\u0438\u0446\u0438\u044f"}),(0,k.jsx)(u.$n,{theme:u.Ox.CLASSIC,onClick:()=>{R(null),y([]),h.undo(),w(h.fen()),F()},children:"\u041d\u0430\u0437\u0430\u0434"}),(0,k.jsx)(u.$n,{onClick:()=>{M("black"===I?"white":"black")},children:"\u041f\u0435\u0440\u0435\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0434\u043e\u0441\u043a\u0443"}),(0,k.jsx)(u.$n,{onClick:()=>{F()},children:"\u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439"})]})]}),(0,k.jsxs)(g.a,{isOpen:P,onClose:B,children:[(0,k.jsx)("p",{children:"\u0418\u0433\u0440\u0430 \u043e\u043a\u043e\u043d\u0447\u0435\u043d\u0430!"}),(0,k.jsxs)("div",{className:o,children:[(0,k.jsx)(u.$n,{onClick:()=>{h.reset(),w(h.fen()),T(!1),F()},children:"\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430"}),(0,k.jsx)(u.$n,{onClick:()=>{T(!1)},children:"\u041d\u0430\u0437\u0430\u0434"})]})]})]})},f=e=>{let{className:s}=e;return(0,k.jsx)("div",{children:(0,k.jsx)(C,{})})}},147:(e,s,t)=>{t.d(s,{R:()=>i});const i={captureSound:new Audio("./sound/capture.mp3"),castlingSound:new Audio("./sound/castling.mp3"),checkSound:new Audio("./sound/check.mp3"),checkmateSound:new Audio("./sound/checkmate.mp3"),moveSound:new Audio("./sound/move.mp3")};for(let n of Object.keys(i))i[n].volume=.2},403:(e,s,t)=>{t.d(s,{A:()=>i});class i{constructor(){this.stockfish=void 0,this.isInitialized=!1,this.readyPromise=void 0,this.resolveReady=void 0,this.messageCallbacks=new Set,this._depth=void 0,this._thinkTime=void 0,this.handleEngineMessage=e=>{const s=e.data,t=this.parseMessage(s);this.messageCallbacks.forEach((e=>e(t))),"readyok"!==s||this.isInitialized||(this.isInitialized=!0,this.resolveReady(),console.log("ENGINE IS INITIALIZED AND READY!"))},this.stockfish=new Worker("./stockfish.js"),this.readyPromise=new Promise((e=>{this.resolveReady=e})),this.initializeEngine()}initializeEngine(){this.stockfish.addEventListener("message",this.handleEngineMessage,{once:!1}),this.stockfish.postMessage("uci"),this.stockfish.postMessage("isready")}async waitForInitialReady(){this.isInitialized||await this.readyPromise}parseMessage(e){var s,t;const i=null===(s=e.match(/bestmove\s+(\S+)/))||void 0===s?void 0:s[1],n=null===(t=e.match(/ponder\s+(\S+)/))||void 0===t?void 0:t[1],a=e.match(/score cp\s+(-?\d+)/),o=e.match(/score mate\s+(-?\d+)/),c=e.match(/info.*\bdepth\s+(\d+)/),l=e.match(/info.*\b pv\s+(.+)/);return{uciMessage:e,bestMove:i||void 0,ponder:n||void 0,positionEvaluation:a?parseInt(a[1],10)/100:void 0,possibleMate:o?parseInt(o[1],10):void 0,pv:l?l[1].trim().split(/\s+/):void 0,depth:c?Number(c[1]):void 0}}addMessageListener(e){this.messageCallbacks.add(e)}removeMessageListener(e){this.messageCallbacks.delete(e)}stop(){this.stockfish.postMessage("stop")}terminate(){this.stop(),this.stockfish.postMessage("quit"),this.messageCallbacks.clear()}setSkillLevel(e){this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name Skill Level value ".concat(e))}))}setDepth(e){e<1?e=1:e>24&&(e=24),this._depth=e,this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name Depth value ".concat(e))})),console.log("\u041d\u043e\u0432\u0430\u044f \u0433\u043b\u0443\u0431\u0438\u043d\u0430 \u043f\u043e\u0438\u0441\u043a\u0430: ".concat(this._depth))}setThinkTime(e){this._thinkTime=e,console.log("\u041d\u043e\u0432\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043d\u0430 \u0445\u043e\u0434 (\u043c\u0438\u043b\u043b\u0438\u0441\u0435\u043a\u0443\u043d\u0434\u044b): ".concat(this._thinkTime))}setThreads(e){this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name Threads value ".concat(e))}))}setMultiPV(e){this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name MultiPV value ".concat(e))}))}setLimitStrength(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1320;this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name UCI_LimitStrength value ".concat(e?"true":"false")),this.stockfish.postMessage("setoption name UCI_Elo value ".concat(s))}))}async evaluatePosition(e){await this.waitForInitialReady(),this.stop(),await new Promise((e=>{const s=t=>{"readyok"===t.data&&(this.stockfish.removeEventListener("message",s),e())};this.stockfish.addEventListener("message",s),this.stockfish.postMessage("ucinewgame"),this.stockfish.postMessage("isready")})),this.stockfish.postMessage("position fen ".concat(e));let s="go";this._depth&&(s+=" depth ".concat(this._depth)),this._thinkTime&&(s+=" movetime ".concat(this._thinkTime)),console.log("[Engine \u2190] ".concat(s)),this.stockfish.postMessage(s)}}},801:(e,s,t)=>{t.d(s,{a:()=>A});var i=t(371),n=t(43),a=t(950);const o=e=>{const{children:s,element:t=document.body}=e;return(0,a.createPortal)(s,t)},c="Modal_Modal__47RDU",l="Modal_overlay__lpaR1",r="Modal_content__TWhw1",h="Modal_opened__iZlPA",d="Modal_isClosing__AoAui";var u=t(579);const A=e=>{const{className:s,children:t,isOpen:a,onClose:A}=e,[m,p]=(0,n.useState)(!1),g=(0,n.useRef)(null),k=(0,n.useCallback)((()=>{A&&(p(!0),g.current=setTimeout((()=>{A(),p(!1)}),300))}),[A]),v=(0,n.useCallback)((e=>{"Escape"===e.key&&k()}),[k]);(0,n.useEffect)((()=>(console.log(""),a&&window.addEventListener("keydown",v),()=>{clearTimeout(g.current),window.removeEventListener("keydown",v)})),[a,v]);const C={[h]:a,[d]:m};return(0,u.jsx)(o,{children:(0,u.jsx)("div",{className:(0,i.x)(c,C,[s]),children:(0,u.jsx)("div",{className:l,onClick:k,children:(0,u.jsx)("div",{className:r,onClick:e=>{e.stopPropagation()},children:t})})})})}},935:(e,s,t)=>{t.d(s,{o:()=>m});var i=t(371);const n="FenInput_FenInput__+TRAY",a="FenInput_copyButton__j+z8x";var o=t(555),c=t(986);const l="Input_Input__hHLh7";var r=t(579);const h=["className"],d=e=>{const{className:s}=e,t=(0,c.A)(e,h);return(0,r.jsx)("input",(0,o.A)({className:(0,i.x)(l,{},[s])},t))};var u=t(43),A=t(445);const m=e=>{let{className:s,fenPosition:t,onChange:o}=e;const[c,l]=(0,u.useState)(!1);return(0,r.jsxs)("div",{className:(0,i.x)(n,{},[s]),children:[(0,r.jsx)(d,{value:c?"":t,onChange:e=>{const s=e.target.value;""!==s&&(l(!1),o&&o(s))},placeholder:"\u0412\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u044e FEN, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0447\u0430\u0442\u044c \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435"}),(0,r.jsx)(A.$n,{onClick:()=>{l(!0)},theme:A.Ox.CLEAR,square:!0,children:(0,r.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAJ2QAACdkBFedbSQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADsSURBVFiFxZdRCoMwDEDfdrv+TZhY2E6v3sKC+1jLZKti02QNCKKS96w1bQAcMMWjwz46YI48RzxZ4xEAbwj3kZF407fACixGEj7m3rJGeA9JwFYiBw9sPnm/88BTAX46t4VEcU5NCXEuDYnqHDUJ1EZRkkh9Ht0LEu7BH1J4iYQZ/IyEOTzFkAEtO9cGbXiK3EiYv/lZCRH8KhC4CO+pRG7CWSxg2Wg6CY9+tZJipQ5PYSZRUmTUJSQVTk2iprxWS2jUdrGE5sJSLNF0U9p0W968MZmN4UcSP73hv5vTET7t+QjcDOEpug3PvQCCkD3RJqwD7gAAAABJRU5ErkJggg==",width:32,alt:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}),(0,r.jsx)(A.$n,{onClick:async()=>{await navigator.clipboard.writeText(t),console.log("copied")},theme:A.Ox.CLEAR,className:a,square:!0,children:(0,r.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAADsAAAA7AF5KHG9AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAATVJREFUWIXt179KxEAQx/GP3pVaKPgMKhy2FmJnYWV3PoaPIIJv4L2EYCFWJ2hpow8gXC+CFgp67XkWd5E1Ekk2uT9FvhDCTjIzP3azkx1mzEJqvIwjtNCIjNnDCQZFHZt4wLCCay9G+U5FyR+xFiOgHQS5xFJMkKIsZtjP0Z+GgGaG/Ss1XsW2+Fnp4x5veQWE7OIKK5HJE95xgLvQmLUEIZ0KkhvHOEsb88xAa3wfGO3vXsHE62O/Brb+ezHcBe3Anti6BROHXAdxfpFnCRI+Swj4yHpQRMBEqAXUAmoBtYBQQFjpMitX1YQ/oxucGtXr21kIGOB4WokT5uobmHsBsY1KWd+fg8QLNiL8N/Eq40CSh2fVNCxDPKWD51mCPwfJEnTShnRzmsUh9pXrC7q4iPSfHN8P6WXseTd0UwAAAABJRU5ErkJggg==",alt:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})})]})}}}]);
//# sourceMappingURL=52.b4504c33.chunk.js.map