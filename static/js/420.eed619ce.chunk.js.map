{"version":3,"file":"static/js/420.eed619ce.chunk.js","mappings":"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","sources":["shared/config/consts/urlParams.ts","shared/lib/sounds/sounds.ts","app/stockfish/engine.ts","webpack://stockfish-web/./src/widgets/MyChessboard/ui/MyChessboard.module.scss?eb1e","widgets/MyChessboard/ui/MyChessboard.tsx","pages/Play/ui/Play.tsx","shared/ui/Portal/Portal.tsx","webpack://stockfish-web/./src/shared/ui/Modal/Modal.module.scss?37a1","shared/ui/Modal/Modal.tsx","webpack://stockfish-web/./src/shared/ui/FenInput/FenInput.module.scss?c4c8","webpack://stockfish-web/./src/shared/ui/Input/Input.module.scss?eef6","shared/ui/Input/Input.tsx","shared/ui/FenInput/FenInput.tsx"],"sourcesContent":["export const urlParams = {\r\n  chessDefaultPosition: \"board-pos\",\r\n};\r\n","const volume = 0.2;\r\n\r\nexport const sounds = {\r\n  captureSound: new Audio(\"./sound/capture.mp3\"),\r\n  castlingSound: new Audio(\"./sound/castling.mp3\"),\r\n  checkSound: new Audio(\"./sound/check.mp3\"),\r\n  checkmateSound: new Audio(\"./sound/checkmate.mp3\"),\r\n  moveSound: new Audio(\"./sound/move.mp3\"),\r\n};\r\n\r\nfor (let key of Object.keys(sounds)) {\r\n  sounds[key].volume = volume;\r\n}\r\n","// documentation: https://official-stockfish.github.io/docs/stockfish-wiki/UCI-&-Commands.html\r\n\r\nconst MINIMUM_DEPTH = 1;\r\nconst MAXIMUM_DEPTH = 24;\r\n\r\ntype EngineMessage = {\r\n  /* –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–≤–∏–∂–∫–∞ Stockfish */\r\n  uciMessage: string;\r\n  /* –Ω–∞–π–¥–µ–Ω –ª—É—á—à–∏–π —Ö–æ–¥ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏: e2e4 */\r\n  bestMove?: string;\r\n  /* —Ö–æ–¥ ¬´ponder¬ª –¥–ª—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞: e7e5 */\r\n  ponder?: string;\r\n  /* –æ—Ü–µ–Ω–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ (–≤ –ø–µ—à–µ—á–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö, ¬±cp/100) */\r\n  positionEvaluation?: number;\r\n  /* –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—Ö–æ–¥–æ–≤ –¥–æ –º–∞—Ç–∞, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –º–∞—Ç */\r\n  possibleMate?: number;\r\n  /* —Å—Ç—Ä–æ–∫–∞ —Å PV (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö–æ–¥–æ–≤), —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏ */\r\n  pv?: string[];\r\n  /* —Ç–µ–∫—É—â–∞—è –≥–ª—É–±–∏–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ */\r\n  depth?: number;\r\n};\r\n\r\nexport type EngineMessageCallback = (msg: EngineMessage) => void;\r\n\r\nexport default class Engine {\r\n  private stockfish: Worker;\r\n  private isInitialized = false;\r\n  private readyPromise: Promise<void>;\r\n  private resolveReady!: () => void;\r\n  private messageCallbacks = new Set<EngineMessageCallback>();\r\n  private _depth: number;\r\n  private _thinkTime: number;\r\n\r\n  constructor() {\r\n    this.stockfish = new Worker(\"./stockfish.js\");\r\n    // —Å–æ–∑–¥–∞—ë–º promise, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ 'readyok'\r\n    this.readyPromise = new Promise((resolve) => {\r\n      this.resolveReady = resolve;\r\n    });\r\n\r\n    this.initializeEngine();\r\n  }\r\n\r\n  /**\r\n   * –ü–µ—Ä–≤—ã–π handshake —Å –¥–≤–∏–∂–∫–æ–º:\r\n   * 1) –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 'uci'\r\n   * 2) –ñ–¥—ë–º 'readyok'\r\n   *\r\n   * –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ 'readyok' —Ñ–ª–∞–≥ this.isInitialized —Å—Ç–∞–Ω–µ—Ç true,\r\n   * –∏ resolveReady() —Ä–∞–∑—Ä–µ—à–∏—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã, –æ–∂–∏–¥–∞—é—â–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–≤–∏–∂–∫–∞.\r\n   */\r\n  private initializeEngine() {\r\n    this.stockfish.addEventListener(\"message\", this.handleEngineMessage, {\r\n      once: false,\r\n    });\r\n\r\n    // –ó–∞–ø—É—Å–∫–∞–µ–º UCI-—Ä–µ–∂–∏–º\r\n    this.stockfish.postMessage(\"uci\");\r\n    // –°–ø—Ä–∞—à–∏–≤–∞–µ–º, –≥–æ—Ç–æ–≤ –ª–∏ –¥–≤–∏–∂–æ–∫\r\n    this.stockfish.postMessage(\"isready\");\r\n  }\r\n\r\n  private handleEngineMessage = (e: MessageEvent) => {\r\n    const data: string = e.data;\r\n    // –õ–æ–≥–∏—Ä—É–µ–º raw-—Å–æ–æ–±—â–µ–Ω–∏—è (–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ production)\r\n    // console.log(\"[Engine ‚Üí]\", data);\r\n\r\n    // –†–∞—Å–ø–∞—Ä—ã–≤–∞–µ–º —á–∞—Å—Ç—å UCI-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\r\n    const msg = this.parseMessage(data);\r\n    // –û–ø–æ–≤–µ—â–∞–µ–º –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π\r\n    this.messageCallbacks.forEach((cb) => cb(msg));\r\n\r\n    // –ü–µ—Ä–≤—ã–π readyok –ø–æ—Å–ª–µ 'isready'\r\n    if (data === \"readyok\" && !this.isInitialized) {\r\n      this.isInitialized = true;\r\n      // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–∑–∏, –∫—Ç–æ –∂–¥—ë—Ç initial ready\r\n      this.resolveReady();\r\n      console.log(\"ENGINE IS INITIALIZED AND READY!\");\r\n    }\r\n  };\r\n\r\n  /**\r\n   * –ñ–¥—ë–º, –ø–æ–∫–∞ –¥–≤–∏–∂–æ–∫ –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç –ø–µ—Ä–≤—ã–º 'readyok'.\r\n   * –í—Å–µ –≤—ã–∑–æ–≤—ã setOption‚Ä¶() –±—É–¥—É—Ç –∂–¥–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç—É promise.\r\n   */\r\n  private async waitForInitialReady(): Promise<void> {\r\n    if (!this.isInitialized) {\r\n      await this.readyPromise;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * –ü–∞—Ä—Å–∏–Ω–≥ –ª—é–±–æ–≥–æ UCI-—Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –¥–≤–∏–∂–∫–∞ –≤ –Ω–∞—à —Ñ–æ—Ä–º–∞—Ç EngineMessage.\r\n   */\r\n  private parseMessage(data: string): EngineMessage {\r\n    const bestMove = data.match(/bestmove\\s+(\\S+)/)?.[1];\r\n    const ponder = data.match(/ponder\\s+(\\S+)/)?.[1];\r\n    const cpMatch = data.match(/score cp\\s+(-?\\d+)/);\r\n    const mateMatch = data.match(/score mate\\s+(-?\\d+)/);\r\n    const depthMatch = data.match(/info.*\\bdepth\\s+(\\d+)/);\r\n    const pvMatch = data.match(/info.*\\b pv\\s+(.+)/);\r\n\r\n    return {\r\n      uciMessage: data,\r\n      bestMove: bestMove || undefined,\r\n      ponder: ponder || undefined,\r\n      positionEvaluation: cpMatch ? parseInt(cpMatch[1], 10) / 100 : undefined,\r\n      possibleMate: mateMatch ? parseInt(mateMatch[1], 10) : undefined,\r\n      pv: pvMatch ? pvMatch[1].trim().split(/\\s+/) : undefined,\r\n      depth: depthMatch ? Number(depthMatch[1]) : undefined,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * –î–æ–±–∞–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è ‚Äî –æ–Ω –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∫–∞–∂–¥—ã–π EngineMessage\r\n   */\r\n  addMessageListener(callback: EngineMessageCallback) {\r\n    this.messageCallbacks.add(callback);\r\n  }\r\n\r\n  removeMessageListener(callback: EngineMessageCallback) {\r\n    this.messageCallbacks.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã ¬´–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è¬ª (–ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫).\r\n   */\r\n  stop() {\r\n    this.stockfish.postMessage(\"stop\");\r\n  }\r\n\r\n  /**\r\n   * –ü–æ–ª–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –¥–≤–∏–∂–∫–æ–º:\r\n   * - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è\r\n   * - –£–¥–∞–ª—è–µ–º –≤—Å–µ—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π\r\n   * - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 'quit'\r\n   */\r\n  terminate() {\r\n    this.stop();\r\n    this.stockfish.postMessage(\"quit\");\r\n    this.messageCallbacks.clear();\r\n  }\r\n\r\n  /****************************\r\n   *   –ú–µ—Ç–æ–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–ø—Ü–∏–π  *\r\n   ****************************/\r\n\r\n  /**\r\n   * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ (Skill Level).\r\n   * –û—Ç–ª–æ–∂–∏—Ç –∫–æ–º–∞–Ω–¥—É, –ø–æ–∫–∞ –¥–≤–∏–∂–æ–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç ready –≤–ø–µ—Ä–≤—ã–µ.\r\n   */\r\n  setSkillLevel(level: number) {\r\n    this.waitForInitialReady().then(() => {\r\n      this.stockfish.postMessage(`setoption name Skill Level value ${level}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É –ø–æ–∏—Å–∫–∞ (UCI_option \"Depth\").\r\n   */\r\n  setDepth(depth: number) {\r\n    if (depth < MINIMUM_DEPTH) depth = MINIMUM_DEPTH;\r\n    else if (depth > MAXIMUM_DEPTH) depth = MAXIMUM_DEPTH;\r\n    this._depth = depth;\r\n\r\n    this.waitForInitialReady().then(() => {\r\n      this.stockfish.postMessage(`setoption name Depth value ${depth}`);\r\n    });\r\n    console.log(`–ù–æ–≤–∞—è –≥–ª—É–±–∏–Ω–∞ –ø–æ–∏—Å–∫–∞: ${this._depth}`);\r\n  }\r\n\r\n  /**\r\n   * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ¬´think time¬ª ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö).\r\n   * –°–∞–º–æ –ø–æ —Å–µ–±–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ setoption:\r\n   * –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ goCommand (–∏–ª–∏ –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ).\r\n   */\r\n  setThinkTime(time: number) {\r\n    this._thinkTime = time;\r\n    console.log(`–ù–æ–≤–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Ö–æ–¥ (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã): ${this._thinkTime}`);\r\n  }\r\n\r\n  /**\r\n   * –ü–æ—Ç–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–≤–∏–∂–æ–∫ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (UCI_option \"Threads\").\r\n   *\r\n   */\r\n  setThreads(threads: number) {\r\n    this.waitForInitialReady().then(() => {\r\n      this.stockfish.postMessage(`setoption name Threads value ${threads}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * –°–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (MultiPV) –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å.\r\n   */\r\n  setMultiPV(n: number) {\r\n    this.waitForInitialReady().then(() => {\r\n      this.stockfish.postMessage(`setoption name MultiPV value ${n}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * –í–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É, –∏ –∑–∞–¥–∞—ë—Ç Elo.\r\n   * (UCI_option UCI_LimitStrength –∏ UCI_Elo).\r\n   */\r\n  setLimitStrength(limit: boolean, elo = 1320) {\r\n    this.waitForInitialReady().then(() => {\r\n      this.stockfish.postMessage(\r\n        `setoption name UCI_LimitStrength value ${limit ? \"true\" : \"false\"}`\r\n      );\r\n      // –ï—Å–ª–∏ limit=false, –∑–Ω–∞—á–µ–Ω–∏–µ UCI_Elo –≤—Å—ë —Ä–∞–≤–Ω–æ ¬´–ø—Ä–∏–º–µ—Ç—Å—è¬ª, –Ω–æ –Ω–µ –±—É–¥–µ—Ç –≤–ª–∏—è—Ç—å.\r\n      this.stockfish.postMessage(`setoption name UCI_Elo value ${elo}`);\r\n    });\r\n  }\r\n\r\n  /*********************************************\r\n   *    –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥: –∞–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–∏ (go)     *\r\n   *********************************************/\r\n\r\n  /**\r\n   * –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ—Ç –¥–≤–∏–∂–∫–∞ –ª—É—á—à–∏–π —Ö–æ–¥ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ FEN.\r\n   * –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º –º—ã:\r\n   *  1) –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ–∏—Å–∫ (stop)\r\n   *  2) –ü–æ—Å—ã–ª–∞–µ–º 'ucinewgame', 'isready' ‚Üí –∂–¥—ë–º –Ω–æ–≤–æ–≥–æ 'readyok'\r\n   *  3) –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é ‚Üí ¬´go depth N¬ª\r\n   */\r\n  async evaluatePosition(fen: string) {\r\n    // –ñ–¥—ë–º, –ø–æ–∫–∞ –¥–≤–∏–∂–æ–∫ –≤–æ–æ–±—â–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω\r\n    await this.waitForInitialReady();\r\n\r\n    // 1) –ü—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–Ω–∞–ª–∏–∑ (–µ—Å–ª–∏ –æ–Ω –±—ã–ª)\r\n    this.stop();\r\n\r\n    // 2) –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–∂–∫–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º –∞–Ω–∞–ª–∏–∑–æ–º\r\n    await new Promise<void>((resolve) => {\r\n      const onReadyForNewGame = (e: MessageEvent) => {\r\n        if (e.data === \"readyok\") {\r\n          this.stockfish.removeEventListener(\"message\", onReadyForNewGame);\r\n          resolve();\r\n        }\r\n      };\r\n      this.stockfish.addEventListener(\"message\", onReadyForNewGame);\r\n      this.stockfish.postMessage(\"ucinewgame\");\r\n      this.stockfish.postMessage(\"isready\");\r\n    });\r\n\r\n    // 3) –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é\r\n    this.stockfish.postMessage(`position fen ${fen}`);\r\n\r\n    // 4) –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É ¬´go¬ª\r\n    let goCommand = `go`;\r\n    if (this._depth) goCommand += ` depth ${this._depth}`;\r\n    if (this._thinkTime) goCommand += ` movetime ${this._thinkTime}`;\r\n    console.log(`[Engine ‚Üê] ${goCommand}`);\r\n    this.stockfish.postMessage(goCommand);\r\n  }\r\n}\r\n","// extracted by mini-css-extract-plugin\nexport default {\"MyChessboard\":\"MyChessboard_MyChessboard__BjqC1\",\"chessboardWrapper\":\"MyChessboard_chessboardWrapper__AtQ+W\",\"buttons\":\"MyChessboard_buttons__Dfxko\"};","import { classNames } from \"shared/lib/classNames/classNames\";\r\nimport cls from \"./MyChessboard.module.scss\";\r\nimport { Button, ButtonTheme } from \"shared/ui/Button/Button\";\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport Engine, { EngineMessageCallback } from \"app/stockfish/engine\";\r\nimport Chess from \"chess.js\";\r\nimport { Chessboard } from \"react-chessboard\";\r\nimport { Piece, Square } from \"react-chessboard/dist/chessboard/types\";\r\nimport { sounds } from \"shared/lib/sounds/sounds\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { urlParams } from \"shared/config/consts/urlParams\";\r\nimport { Modal } from \"shared/ui/Modal/Modal\";\r\nimport { Input } from \"shared/ui/Input/Input\";\r\nimport { FenInput } from \"shared/ui/FenInput/FenInput\";\r\n\r\ninterface MyChessboardProps {\r\n  className?: string;\r\n  defaultPosition?: string;\r\n}\r\n\r\ninterface LevelsConfig {\r\n  text: string;\r\n  skill: number;\r\n  depth: number;\r\n  thinkTime: number;\r\n  elo?: number;\r\n  multiPV?: number;\r\n  threads?: number; // –ª—É—á—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å\r\n}\r\n\r\nconst levels: Record<string, LevelsConfig> = {\r\n  easy: {\r\n    text: \"–õ–µ–≥–∫–æ ü§ì\",\r\n    skill: 2,\r\n    depth: 5,\r\n    thinkTime: 500,\r\n  },\r\n  normal: {\r\n    text: \"–ù–æ—Ä–º–∞–ª—å–Ω–æ üßê\",\r\n    skill: 10,\r\n    depth: 12,\r\n    thinkTime: 1000,\r\n  },\r\n  hard: {\r\n    text: \"–°–ª–æ–∂–Ω–æ üòµ\",\r\n    skill: 20,\r\n    depth: 22,\r\n    thinkTime: 3000,\r\n  },\r\n};\r\n\r\nexport const MyChessboard = ({\r\n  className,\r\n  defaultPosition,\r\n}: MyChessboardProps) => {\r\n  const location = useLocation();\r\n  const params = useMemo(\r\n    () => new URLSearchParams(location.search),\r\n    [location.search]\r\n  );\r\n\r\n  const game = useMemo(() => new Chess(), []);\r\n\r\n  defaultPosition = useMemo(\r\n    () =>\r\n      defaultPosition ||\r\n      params.get(urlParams.chessDefaultPosition) ||\r\n      game.fen(),\r\n    [defaultPosition, params, game]\r\n  );\r\n\r\n  const engineRef = useRef<Engine | null>(null);\r\n  const [gamePosition, setGamePosition] = useState(\r\n    defaultPosition || params.get(urlParams.chessDefaultPosition) || game.fen()\r\n  );\r\n  const [stockfishLevel, setStockfishLevel] =\r\n    useState<keyof typeof levels>(\"easy\");\r\n  const [boardOrientation, setBoardOrientation] = useState<\"white\" | \"black\">(\r\n    \"white\"\r\n  );\r\n\r\n  // –ü—Ä–∏ —Å–º–µ–Ω–µ —É—Ä–æ–≤–Ω—è —Å–æ–∑–¥–∞—ë–º (–∏–ª–∏ –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º) –¥–≤–∏–∂–æ–∫\r\n  useEffect(() => {\r\n    // –ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π engine —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∑–∞–≤–µ—Ä—à–∞–µ–º –µ–≥–æ\r\n    if (engineRef.current) {\r\n      engineRef.current.terminate();\r\n    }\r\n\r\n    const engine = new Engine();\r\n    engineRef.current = engine;\r\n\r\n    const config = levels[stockfishLevel];\r\n\r\n    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ª–∏–º–∏—Ç –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º skill/depth/threads/multiPV\r\n    engine.setLimitStrength(false);\r\n    engine.setSkillLevel(config.skill);\r\n    engine.setDepth(config.depth);\r\n    engine.setThinkTime(config.thinkTime);\r\n\r\n    if (config.elo) {\r\n      engine.setLimitStrength(true, config.elo);\r\n    }\r\n\r\n    if (config.threads) {\r\n      engine.setThreads(config.threads);\r\n    }\r\n\r\n    if (config.multiPV) {\r\n      engine.setMultiPV(config.multiPV);\r\n    }\r\n\r\n    console.log(`Stockfish —É—Ä–æ–≤–µ–Ω—å: ${stockfishLevel}`, config);\r\n\r\n    return () => {\r\n      engine.terminate();\r\n      engineRef.current = null;\r\n    };\r\n  }, [stockfishLevel]);\r\n\r\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ Chess.js\r\n  useEffect(() => {\r\n    game.load(defaultPosition);\r\n  }, [defaultPosition, game]);\r\n\r\n  function move(moveObj: {\r\n    from: string;\r\n    to: string;\r\n    promotion?: string;\r\n  }): boolean {\r\n    const moved = game.move(moveObj);\r\n    setGamePosition(game.fen());\r\n\r\n    if (moved === null) {\r\n      return false;\r\n    }\r\n    if (game.game_over() || game.in_draw()) {\r\n      sounds.checkmateSound.play();\r\n      setIsGameOverModal(true);\r\n      return false;\r\n    }\r\n    if (game.in_check()) {\r\n      sounds.checkSound.play();\r\n      return true;\r\n    }\r\n    if (moved.san === \"O-O-O\" || moved.san === \"O-O\") {\r\n      sounds.castlingSound.play();\r\n      return true;\r\n    }\r\n    if (moved.captured) {\r\n      sounds.captureSound.play();\r\n      return true;\r\n    }\r\n    sounds.moveSound.play();\r\n    return true;\r\n  }\r\n\r\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Engine\r\n  const handler: EngineMessageCallback = (message) => {\r\n    console.log(\"[React ‚Üê EngineMessage]\", message);\r\n\r\n    const engine = engineRef.current;\r\n    if (!engine) return;\r\n\r\n    if (message.bestMove) {\r\n      // –ï—Å–ª–∏ –µ—Å—Ç—å –ª—É—á—à–∏–π —Ö–æ–¥ ‚Äî —Å—Ä–∞–∑—É –µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ–º\r\n      const selectedMove = message.bestMove;\r\n      const moveResult = move({\r\n        from: selectedMove.substring(0, 2),\r\n        to: selectedMove.substring(2, 4),\r\n        promotion:\r\n          selectedMove.length > 4 ? selectedMove.substring(4, 5) : undefined,\r\n      });\r\n\r\n      engine.removeMessageListener(handler);\r\n\r\n      if (!moveResult) {\r\n        engine.stop();\r\n      }\r\n    }\r\n  };\r\n\r\n  async function findBestMove() {\r\n    const engine = engineRef.current;\r\n    if (!engine) return;\r\n\r\n    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –æ—Ü–µ–Ω–∫–æ–π\r\n    engine.addMessageListener(handler);\r\n    console.log(\"–ó–∞–ø—Ä–æ—Å –ª—É—á—à–µ–≥–æ —Ö–æ–¥–∞‚Ä¶\");\r\n\r\n    try {\r\n      await engine.evaluatePosition(game.fen());\r\n    } catch (error) {\r\n      engine.removeMessageListener(handler);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  function onDrop(sourceSquare: Square, targetSquare: Square, piece: Piece) {\r\n    console.log(`[Player move] ${sourceSquare} ‚Üí ${targetSquare}`, piece);\r\n    const notEnd = move({\r\n      from: sourceSquare,\r\n      to: targetSquare,\r\n      promotion: piece[1].toLowerCase(),\r\n    });\r\n\r\n    if (notEnd) {\r\n      setTimeout(() => {\r\n        findBestMove();\r\n      }, 500);\r\n    }\r\n    return notEnd;\r\n  }\r\n\r\n  const [isGameOverModal, setIsGameOverModal] = useState(false);\r\n\r\n  const onToggleModal = useCallback(() => {\r\n    setIsGameOverModal(!isGameOverModal);\r\n  }, [isGameOverModal]);\r\n\r\n  const handleFenInputChange = (fen: string) => {\r\n    const { valid } = game.validate_fen(fen);\r\n    if (valid) {\r\n      game.load(fen);\r\n      setGamePosition(game.fen());\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={classNames(cls.MyChessboard, {}, [className || \"\"])}>\r\n      <div className={cls.chessboardWrapper}>\r\n        <div className={cls.buttons}>\r\n          {Object.entries(levels).map(([level, config]) => (\r\n            <Button\r\n              key={level}\r\n              onClick={() => setStockfishLevel(level as keyof typeof levels)}\r\n              theme={ButtonTheme.CLASSIC}\r\n              active={stockfishLevel === level}\r\n            >\r\n              {config.text}\r\n            </Button>\r\n          ))}\r\n        </div>\r\n\r\n        <Chessboard\r\n          id=\"PlayVsStockfish\"\r\n          position={gamePosition}\r\n          onPieceDrop={onDrop}\r\n          boardOrientation={boardOrientation}\r\n        />\r\n\r\n        <div className={cls.buttons}>\r\n          <Button\r\n            onClick={() => {\r\n              game.reset();\r\n              setGamePosition(game.fen());\r\n            }}\r\n          >\r\n            –ù–æ–≤–∞—è –∏–≥—Ä–∞\r\n          </Button>\r\n          <Button\r\n            onClick={() => {\r\n              game.undo();\r\n              game.undo();\r\n              setGamePosition(game.fen());\r\n            }}\r\n          >\r\n            –ù–∞–∑–∞–¥\r\n          </Button>\r\n          <Button\r\n            onClick={() => {\r\n              setBoardOrientation(\r\n                boardOrientation === \"black\" ? \"white\" : \"black\"\r\n              );\r\n            }}\r\n          >\r\n            –ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –¥–æ—Å–∫—É\r\n          </Button>\r\n          <Button\r\n            onClick={() => {\r\n              findBestMove();\r\n            }}\r\n          >\r\n            –•–æ–¥–∏\r\n          </Button>\r\n        </div>\r\n        <FenInput fenPosition={gamePosition} onChange={handleFenInputChange} />\r\n      </div>\r\n      <Modal isOpen={isGameOverModal} onClose={onToggleModal}>\r\n        <p>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</p>\r\n        <div className={cls.buttons}>\r\n          <Button\r\n            onClick={() => {\r\n              game.reset();\r\n              setGamePosition(game.fen());\r\n              setIsGameOverModal(false);\r\n            }}\r\n          >\r\n            –ù–æ–≤–∞—è –∏–≥—Ä–∞\r\n          </Button>\r\n          <Button\r\n            onClick={() => {\r\n              setIsGameOverModal(false);\r\n            }}\r\n          >\r\n            –ù–∞–∑–∞–¥\r\n          </Button>\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n","import { MyChessboard } from \"widgets/MyChessboard\";\r\n\r\ninterface PlayProps {\r\n  className?: string;\r\n}\r\n\r\nconst Play = ({ className }: PlayProps) => {\r\n  return (\r\n    <div>\r\n      <MyChessboard />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Play;\r\n","import { ReactNode } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\n\r\ninterface PortalProps {\r\n  children: ReactNode;\r\n  element?: HTMLElement\r\n}\r\n\r\nexport const Portal = (props: PortalProps) => {\r\n  const {\r\n    children,\r\n    element = document.body,\r\n  } = props;\r\n\r\n  return (\r\n    createPortal(children, element)\r\n  );\r\n};\r\n","// extracted by mini-css-extract-plugin\nexport default {\"Modal\":\"Modal_Modal__47RDU\",\"overlay\":\"Modal_overlay__lpaR1\",\"content\":\"Modal_content__TWhw1\",\"opened\":\"Modal_opened__iZlPA\",\"isClosing\":\"Modal_isClosing__AoAui\"};","import { classNames } from \"shared/lib/classNames/classNames\";\r\nimport {\r\n  MouseEvent,\r\n  ReactNode,\r\n  useCallback,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { Portal } from \"shared/ui/Portal/Portal\";\r\nimport cls from \"./Modal.module.scss\";\r\n\r\ninterface ModalProps {\r\n  className?: string;\r\n  children?: ReactNode;\r\n  isOpen?: boolean;\r\n  onClose?: () => void;\r\n}\r\n\r\nconst ANIMATION_DELAY = 300;\r\n\r\nexport const Modal = (props: ModalProps) => {\r\n  const { className, children, isOpen, onClose } = props;\r\n\r\n  const [isClosing, setIsClosing] = useState(false);\r\n  const timerRef = useRef<ReturnType<typeof setTimeout>>(null);\r\n\r\n  const closeHandler = useCallback(() => {\r\n    if (onClose) {\r\n      setIsClosing(true);\r\n      timerRef.current = setTimeout(() => {\r\n        onClose();\r\n        setIsClosing(false);\r\n      }, ANIMATION_DELAY);\r\n    }\r\n  }, [onClose]);\r\n\r\n  const onContentClick = (e: MouseEvent) => {\r\n    e.stopPropagation();\r\n  };\r\n\r\n  const onKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\") {\r\n        closeHandler();\r\n      }\r\n    },\r\n    [closeHandler]\r\n  );\r\n\r\n  useEffect(() => {\r\n    console.log(\"\");\r\n\r\n    if (isOpen) {\r\n      window.addEventListener(\"keydown\", onKeyDown);\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(timerRef.current);\r\n      window.removeEventListener(\"keydown\", onKeyDown);\r\n    };\r\n  }, [isOpen, onKeyDown]);\r\n\r\n  const mods: Record<string, boolean> = {\r\n    [cls.opened]: isOpen,\r\n    [cls.isClosing]: isClosing,\r\n  };\r\n\r\n  return (\r\n    <Portal>\r\n      <div className={classNames(cls.Modal, mods, [className])}>\r\n        <div className={cls.overlay} onClick={closeHandler}>\r\n          <div className={cls.content} onClick={onContentClick}>\r\n            {children}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Portal>\r\n  );\r\n};\r\n","// extracted by mini-css-extract-plugin\nexport default {\"FenInput\":\"FenInput_FenInput__+TRAY\",\"copyButton\":\"FenInput_copyButton__j+z8x\"};","// extracted by mini-css-extract-plugin\nexport default {\"Input\":\"Input_Input__hHLh7\"};","import { classNames } from \"shared/lib/classNames/classNames\";\r\nimport cls from \"./Input.module.scss\";\r\nimport { InputHTMLAttributes } from \"react\";\r\n\r\ninterface InputProps extends InputHTMLAttributes<HTMLInputElement> {\r\n  className?: string;\r\n}\r\n\r\nexport const Input = (props: InputProps) => {\r\n  const { className, ...restProps } = props;\r\n  return (\r\n    <input className={classNames(cls.Input, {}, [className])} {...restProps} />\r\n  );\r\n};\r\n","import { classNames } from \"shared/lib/classNames/classNames\";\r\nimport cls from \"./FenInput.module.scss\";\r\nimport { Input } from \"../Input/Input\";\r\nimport { ChangeEvent, useState } from \"react\";\r\nimport { Button, ButtonTheme } from \"../Button/Button\";\r\nimport copyImg from \"shared/assets/copy.png\";\r\nimport krestImg from \"shared/assets/krest.png\";\r\n\r\ninterface FenInputProps {\r\n  className?: string;\r\n  fenPosition: string;\r\n  onChange: (fen: string) => void;\r\n}\r\n\r\nexport const FenInput = ({\r\n  className,\r\n  fenPosition,\r\n  onChange,\r\n}: FenInputProps) => {\r\n  const [isNull, setIsNull] = useState(false);\r\n\r\n  const handleFenInputChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n    const fen = e.target.value;\r\n    if (fen === \"\") return;\r\n    setIsNull(false);\r\n    if (onChange) {\r\n      onChange(fen);\r\n    }\r\n  };\r\n\r\n  const copy = () => {\r\n    navigator.clipboard.writeText(fenPosition);\r\n    console.log(\"copied\");\r\n  };\r\n\r\n  const deleteFen = () => {\r\n    setIsNull(true);\r\n  };\r\n\r\n  return (\r\n    <div className={classNames(cls.FenInput, {}, [className])}>\r\n      <Input\r\n        value={isNull ? \"\" : fenPosition}\r\n        onChange={handleFenInputChange}\r\n        placeholder=\"–í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–∑–∏—Ü–∏—é FEN, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\"\r\n      />\r\n      <Button onClick={deleteFen} theme={ButtonTheme.CLEAR} square>\r\n        <img src={krestImg} width={32} alt=\"–£–¥–∞–ª–∏—Ç—å\" />\r\n      </Button>\r\n      <Button\r\n        onClick={copy}\r\n        theme={ButtonTheme.CLEAR}\r\n        className={cls.copyButton}\r\n        square\r\n      >\r\n        <img src={copyImg} alt=\"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å\" />\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n"],"names":["urlParams","chessDefaultPosition","sounds","captureSound","Audio","castlingSound","checkSound","checkmateSound","moveSound","key","Object","keys","volume","Engine","constructor","stockfish","isInitialized","readyPromise","resolveReady","messageCallbacks","Set","_depth","_thinkTime","handleEngineMessage","e","data","msg","this","parseMessage","forEach","cb","console","log","Worker","Promise","resolve","initializeEngine","addEventListener","once","postMessage","waitForInitialReady","_data$match","_data$match2","bestMove","match","ponder","cpMatch","mateMatch","depthMatch","pvMatch","uciMessage","undefined","positionEvaluation","parseInt","possibleMate","pv","trim","split","depth","Number","addMessageListener","callback","add","removeMessageListener","delete","stop","terminate","clear","setSkillLevel","level","then","concat","setDepth","setThinkTime","time","setThreads","threads","setMultiPV","n","setLimitStrength","limit","elo","arguments","length","evaluatePosition","fen","onReadyForNewGame","removeEventListener","goCommand","levels","easy","text","skill","thinkTime","normal","hard","MyChessboard","_ref","className","defaultPosition","location","useLocation","params","useMemo","URLSearchParams","search","game","Chess","get","engineRef","useRef","gamePosition","setGamePosition","useState","stockfishLevel","setStockfishLevel","boardOrientation","setBoardOrientation","move","moveObj","moved","game_over","in_draw","play","setIsGameOverModal","in_check","san","captured","useEffect","current","engine","config","multiPV","load","handler","message","selectedMove","moveResult","from","substring","to","promotion","async","findBestMove","error","isGameOverModal","onToggleModal","useCallback","_jsxs","classNames","cls","children","_jsx","entries","map","_ref2","Button","onClick","theme","ButtonTheme","CLASSIC","active","Chessboard","id","position","onPieceDrop","sourceSquare","targetSquare","piece","notEnd","toLowerCase","setTimeout","reset","undo","FenInput","fenPosition","onChange","valid","validate_fen","Modal","isOpen","onClose","Portal","props","element","document","body","createPortal","isClosing","setIsClosing","timerRef","closeHandler","onKeyDown","window","clearTimeout","mods","stopPropagation","Input","restProps","_objectWithoutProperties","_excluded","_objectSpread","isNull","setIsNull","value","target","placeholder","deleteFen","CLEAR","square","src","width","alt","copy","navigator","clipboard","writeText"],"sourceRoot":""}