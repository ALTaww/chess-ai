{"version":3,"file":"static/js/11.93452e18.chunk.js","mappings":"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","sources":["webpack://stockfish-web/./src/widgets/StockfishOnlineChessboard/ui/StockfishOnlineChessboard.module.scss?5fb4","widgets/StockfishOnlineChessboard/ui/StockfishOnlineChessboard.tsx","shared/lib/createNewAbortController/createNewAbortController.ts","pages/StockfishOnline/ui/StockfishOnline.tsx","shared/config/consts/urlParams.ts","shared/lib/sounds/sounds.ts"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"StockfishOnlineChessboard\":\"StockfishOnlineChessboard_StockfishOnlineChessboard__Xm861\",\"chessboardWrapper\":\"StockfishOnlineChessboard_chessboardWrapper__LJGcy\",\"buttons\":\"StockfishOnlineChessboard_buttons__0Mnm9\"};","import { classNames } from \"shared/lib/classNames/classNames\";\r\nimport cls from \"./StockfishOnlineChessboard.module.scss\";\r\nimport { Button, ButtonTheme } from \"shared/ui/Button/Button\";\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport Chess from \"chess.js\";\r\nimport { Chessboard, ChessboardDnDProvider } from \"react-chessboard\";\r\nimport { Piece, Square } from \"react-chessboard/dist/chessboard/types\";\r\nimport { sounds } from \"shared/lib/sounds/sounds\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { urlParams } from \"shared/config/consts/urlParams\";\r\nimport axios from \"axios\";\r\nimport { createNewAbortController } from \"shared/lib/createNewAbortController/createNewAbortController\";\r\n\r\ninterface StockfishOnlineChessboardProps {\r\n  className?: string;\r\n  defaultPosition?: string;\r\n}\r\n\r\ninterface LevelsConfig {\r\n  text: string;\r\n  depth: number;\r\n}\r\n\r\ntype BestMoveString = `bestmove ${string} ponder ${string}`;\r\n\r\ninterface ApiResponse {\r\n  success: boolean;\r\n  evaluation: number | null; // –õ–∏–±–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ü–µ–Ω–∫—É –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –ª–∏–±–æ null, –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Ç.\r\n  mate: null | number; // (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –º–∞—Ç —Å—Ç–∞–≤—è—Ç –±–µ–ª—ã–µ, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –º–∞—Ç —Å—Ç–∞–≤—è—Ç —á–µ—Ä–Ω—ã–µ)\r\n  bestmove: BestMoveString; // –°–æ–¥–µ—Ä–∂–∏—Ç –ª—É—á—à–∏–π —Ö–æ–¥ –≤ –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏\r\n  continuation: string; // –í–µ—Ä—Ö–Ω—è—è –ª–∏–Ω–∏—è –¥–≤–∏–≥–∞—Ç–µ–ª—è –≤ –ø–æ–∑–∏—Ü–∏–∏.\r\n  data?: unknown; // –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ\r\n}\r\n\r\n// –£—Ä–æ–≤–Ω–∏ —Å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏\r\nconst levels: Record<string, LevelsConfig> = {\r\n  easy: {\r\n    text: \"–õ–µ–≥–∫–æ ü§ì\",\r\n    depth: 5, // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞\r\n  },\r\n  normal: {\r\n    text: \"–ù–æ—Ä–º–∞–ª—å–Ω–æ üßê\",\r\n    depth: 8, // –£–º–µ—Ä–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞\r\n  },\r\n  hard: {\r\n    text: \"–°–ª–æ–∂–Ω–æ üòµ\",\r\n    depth: 15, // –ì–ª—É–±–æ–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\r\n  },\r\n};\r\n\r\nfunction parseBestMoveLine(line: string): {\r\n  bestMove: string | null;\r\n  ponder: string | null;\r\n} {\r\n  // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–æ–∫–∏ bestmove\r\n  const bestMoveMatch = line.match(/^bestmove\\s+(\\S{4,6})/);\r\n  const bestMove = bestMoveMatch ? bestMoveMatch[1] : null;\r\n\r\n  // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ponder (–µ—Å–ª–∏ –µ—Å—Ç—å)\r\n  const ponderMatch = line.match(/\\sponder\\s+(\\S{4,6})$/);\r\n  const ponder = ponderMatch ? ponderMatch[1] : null;\r\n\r\n  return { bestMove, ponder };\r\n}\r\n\r\nconst API_URL = \"https://stockfish.online/api/s/v2.php\";\r\nconst MOVE_DELAY = 500;\r\n\r\nexport const StockfishOnlineChessboard = ({\r\n  className,\r\n  defaultPosition,\r\n}: StockfishOnlineChessboardProps) => {\r\n  const location = useLocation();\r\n  const params = useMemo(\r\n    () => new URLSearchParams(location.search),\r\n    [location.search]\r\n  );\r\n\r\n  const game = useMemo(() => new Chess(), []);\r\n\r\n  defaultPosition = useMemo(\r\n    () =>\r\n      defaultPosition ||\r\n      params.get(urlParams.chessDefaultPosition) ||\r\n      game.fen(),\r\n    [defaultPosition, params, game]\r\n  );\r\n\r\n  const [gamePosition, setGamePosition] = useState(defaultPosition);\r\n  const [stockfishLevel, setStockfishLevel] =\r\n    useState<keyof typeof levels>(\"easy\");\r\n\r\n  const abortControllerRef = useRef<AbortController>(null);\r\n  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é\r\n  useEffect(() => {\r\n    game.load(defaultPosition);\r\n  }, [defaultPosition, game]);\r\n\r\n  function move(moveObj: { from: string; to: string; promotion?: string }) {\r\n    const moved: {\r\n      captured?: string;\r\n      color: \"w\" | \"b\";\r\n      from: Square;\r\n      to: Square;\r\n      san?: string;\r\n      piece: Piece;\r\n    } | null = game.move(moveObj);\r\n\r\n    setGamePosition(game.fen());\r\n    console.log(moved);\r\n    if (moved === null) {\r\n      return false;\r\n    }\r\n\r\n    if (game.game_over() || game.in_draw()) {\r\n      sounds.checkmateSound.play();\r\n      return false;\r\n    }\r\n\r\n    if (game.in_check()) {\r\n      sounds.checkSound.play();\r\n      return true;\r\n    }\r\n\r\n    if (moved.san === \"O-O-O\" || moved.san === \"O-O\") {\r\n      sounds.castlingSound.play();\r\n      return true;\r\n    }\r\n\r\n    if (moved.captured) {\r\n      sounds.captureSound.play();\r\n      return true;\r\n    }\r\n\r\n    sounds.moveSound.play();\r\n    return true;\r\n  }\r\n\r\n  async function findBestMove() {\r\n    try {\r\n      const { controller, signal } =\r\n        createNewAbortController(abortControllerRef);\r\n      abortControllerRef.current = controller;\r\n\r\n      const { data } = await axios.get<ApiResponse>(API_URL, {\r\n        params: {\r\n          fen: game.fen(),\r\n          depth: levels[stockfishLevel].depth,\r\n        },\r\n        signal: signal,\r\n      });\r\n\r\n      console.log(data);\r\n\r\n      if (!data.success) {\r\n        console.error(data.data);\r\n        return;\r\n      }\r\n\r\n      const { bestMove, ponder } = parseBestMoveLine(data.bestmove);\r\n\r\n      console.log(bestMove, ponder);\r\n\r\n      const notEnd = move({\r\n        from: bestMove.slice(0, 2),\r\n        to: bestMove.slice(2, 4),\r\n        promotion: bestMove.slice(4, 6).toLowerCase(),\r\n      });\r\n    } catch (error) {\r\n      throw error;\r\n    } finally {\r\n      abortControllerRef.current = null;\r\n    }\r\n  }\r\n\r\n  function onDrop(sourceSquare: Square, targetSquare: Square, piece: Piece) {\r\n    console.log(sourceSquare, targetSquare, piece);\r\n    const notEnd = move({\r\n      from: sourceSquare,\r\n      to: targetSquare,\r\n      promotion: piece[1].toLowerCase(),\r\n    });\r\n\r\n    // –ó–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –∫–æ–º–ø—å—é—Ç–µ—Ä –Ω–µ —Ö–æ–¥–∏–ª –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ\r\n    if (notEnd) {\r\n      setTimeout(() => {\r\n        findBestMove();\r\n      }, MOVE_DELAY);\r\n    }\r\n    return notEnd;\r\n  }\r\n\r\n  return (\r\n    <div className={classNames(cls.StockfishOnlineChessboard, {}, [className])}>\r\n      <div className={cls.chessboardWrapper}>\r\n        <div className={cls.buttons}>\r\n          {Object.entries(levels).map(([level, config]) => (\r\n            <Button\r\n              key={`${level}`}\r\n              onClick={() => setStockfishLevel(level)}\r\n              theme={ButtonTheme.CLASSIC}\r\n              active={stockfishLevel === level}\r\n            >\r\n              {config.text}\r\n            </Button>\r\n          ))}\r\n        </div>\r\n\r\n        <Chessboard\r\n          id=\"chessboard\"\r\n          position={gamePosition}\r\n          onPieceDrop={onDrop}\r\n        />\r\n\r\n        <div className={cls.buttons}>\r\n          <Button\r\n            onClick={() => {\r\n              game.reset();\r\n              setGamePosition(game.fen());\r\n            }}\r\n          >\r\n            –ù–æ–≤–∞—è –∏–≥—Ä–∞\r\n          </Button>\r\n          <Button\r\n            onClick={() => {\r\n              game.undo();\r\n              game.undo();\r\n              setGamePosition(game.fen());\r\n            }}\r\n          >\r\n            –ù–∞–∑–∞–¥\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","export function createNewAbortController(\r\n  abortControllerRef: React.RefObject<AbortController | null>\r\n): { controller: AbortController; signal: AbortSignal } {\r\n  if (abortControllerRef.current) {\r\n    abortControllerRef.current.abort(); // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã\r\n  }\r\n  abortControllerRef.current = new AbortController(); // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π AbortController\r\n  return {\r\n    controller: abortControllerRef.current,\r\n    signal: abortControllerRef.current.signal,\r\n  };\r\n}\r\n","import { StockfishOnlineChessboard } from \"widgets/StockfishOnlineChessboard\";\r\n\r\ninterface StockfishOnlineProps {\r\n  className?: string;\r\n}\r\n\r\nconst StockfishOnline = ({ className }: StockfishOnlineProps) => {\r\n  return (\r\n    <div>\r\n      <StockfishOnlineChessboard />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StockfishOnline;\r\n","export const urlParams = {\r\n  chessDefaultPosition: \"board-pos\",\r\n};\r\n","const volume = 0.2;\r\n\r\nexport const sounds = {\r\n  captureSound: new Audio(\"./sound/capture.mp3\"),\r\n  castlingSound: new Audio(\"./sound/castling.mp3\"),\r\n  checkSound: new Audio(\"./sound/check.mp3\"),\r\n  checkmateSound: new Audio(\"./sound/checkmate.mp3\"),\r\n  moveSound: new Audio(\"./sound/move.mp3\"),\r\n};\r\n\r\nfor (let key of Object.keys(sounds)) {\r\n  sounds[key].volume = volume;\r\n}\r\n"],"names":["levels","easy","text","depth","normal","hard","StockfishOnlineChessboard","_ref","className","defaultPosition","location","useLocation","params","useMemo","URLSearchParams","search","game","Chess","get","urlParams","chessDefaultPosition","fen","gamePosition","setGamePosition","useState","stockfishLevel","setStockfishLevel","abortControllerRef","useRef","move","moveObj","moved","console","log","game_over","in_draw","sounds","checkmateSound","play","in_check","checkSound","san","castlingSound","captured","captureSound","moveSound","async","findBestMove","controller","signal","current","abort","AbortController","createNewAbortController","data","axios","success","error","bestMove","ponder","line","bestMoveMatch","match","ponderMatch","parseBestMoveLine","bestmove","from","slice","to","promotion","toLowerCase","useEffect","load","_jsx","classNames","cls","children","_jsxs","Object","entries","map","_ref2","level","config","Button","onClick","theme","ButtonTheme","CLASSIC","active","concat","Chessboard","id","position","onPieceDrop","sourceSquare","targetSquare","piece","notEnd","setTimeout","reset","undo","Audio","key","keys","volume"],"sourceRoot":""}