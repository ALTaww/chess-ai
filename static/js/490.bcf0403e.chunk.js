"use strict";(self.webpackChunkstockfish_web=self.webpackChunkstockfish_web||[]).push([[490],{145:(e,s,t)=>{t.d(s,{_:()=>i});const i={chessDefaultPosition:"board-pos"}},147:(e,s,t)=>{t.d(s,{R:()=>i});const i={captureSound:new Audio("./sound/capture.mp3"),castlingSound:new Audio("./sound/castling.mp3"),checkSound:new Audio("./sound/check.mp3"),checkmateSound:new Audio("./sound/checkmate.mp3"),moveSound:new Audio("./sound/move.mp3")};for(let o of Object.keys(i))i[o].volume=.2},490:(e,s,t)=>{t.r(s),t.d(s,{default:()=>M});var i=t(371);const o="MyChessboard_MyChessboard__BjqC1",n="MyChessboard_chessboardWrapper__AtQ+W",a="MyChessboard_buttons__Dfxko";var c=t(445),h=t(43);class l{constructor(){this.stockfish=void 0,this.isInitialized=!1,this.readyPromise=void 0,this.resolveReady=void 0,this.messageCallbacks=new Set,this._depth=5,this._thinkTime=1e3,this.handleEngineMessage=e=>{const s=e.data;console.log("[Engine \u2192]",s);const t=this.parseMessage(s);this.messageCallbacks.forEach((e=>e(t))),"readyok"!==s||this.isInitialized||(this.isInitialized=!0,this.resolveReady(),console.log("ENGINE IS INITIALIZED AND READY!"))},this.stockfish=new Worker("./stockfish.js"),this.readyPromise=new Promise((e=>{this.resolveReady=e})),this.initializeEngine()}initializeEngine(){this.stockfish.addEventListener("message",this.handleEngineMessage,{once:!1}),this.stockfish.postMessage("uci"),this.stockfish.postMessage("isready")}async waitForInitialReady(){this.isInitialized||await this.readyPromise}parseMessage(e){var s,t;const i=null===(s=e.match(/bestmove\s+(\S+)/))||void 0===s?void 0:s[1],o=null===(t=e.match(/ponder\s+(\S+)/))||void 0===t?void 0:t[1],n=e.match(/score cp\s+(-?\d+)/),a=e.match(/score mate\s+(-?\d+)/),c=e.match(/info.*\bdepth\s+(\d+)/),h=e.match(/info.*\b pv\s+(.+)/);return{uciMessage:e,bestMove:i||void 0,ponder:o||void 0,positionEvaluation:n?parseInt(n[1],10)/100:void 0,possibleMate:a?parseInt(a[1],10):void 0,pv:h?h[1].trim().split(/\s+/):void 0,depth:c?Number(c[1]):void 0}}addMessageListener(e){this.messageCallbacks.add(e)}removeMessageListener(e){this.messageCallbacks.delete(e)}stop(){this.stockfish.postMessage("stop")}terminate(){this.stop(),this.stockfish.postMessage("quit"),this.messageCallbacks.clear()}setSkillLevel(e){this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name Skill Level value ".concat(e))}))}setDepth(e){e<1?e=1:e>24&&(e=24),this._depth=e,this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name Depth value ".concat(e))})),console.log("\u041d\u043e\u0432\u0430\u044f \u0433\u043b\u0443\u0431\u0438\u043d\u0430 \u043f\u043e\u0438\u0441\u043a\u0430: ".concat(this._depth))}setThinkTime(e){this._thinkTime=e,console.log("\u041d\u043e\u0432\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043d\u0430 \u0445\u043e\u0434 (\u043c\u0438\u043b\u043b\u0438\u0441\u0435\u043a\u0443\u043d\u0434\u044b): ".concat(this._thinkTime))}setThreads(e){this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name Threads value ".concat(e))}))}setMultiPV(e){this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name MultiPV value ".concat(e))}))}setLimitStrength(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1320;this.waitForInitialReady().then((()=>{this.stockfish.postMessage("setoption name UCI_LimitStrength value ".concat(e?"true":"false")),this.stockfish.postMessage("setoption name UCI_Elo value ".concat(s))}))}async evaluatePosition(e){await this.waitForInitialReady(),this.stop(),await new Promise((e=>{const s=t=>{"readyok"===t.data&&(this.stockfish.removeEventListener("message",s),e())};this.stockfish.addEventListener("message",s),this.stockfish.postMessage("ucinewgame"),this.stockfish.postMessage("isready")})),this.stockfish.postMessage("position fen ".concat(e));const s="go depth ".concat(this._depth," movetime ").concat(this._thinkTime);console.log("[Engine \u2190] ".concat(s)),this.stockfish.postMessage(s)}}var r=t(629),d=t.n(r),u=t(846),m=t(147),p=t(2),g=t(145),k=t(579);const v={easy:{text:"\u041b\u0435\u0433\u043a\u043e \ud83e\udd13",skill:2,depth:5,thinkTime:500},normal:{text:"\u041d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e \ud83e\uddd0",skill:10,depth:12,thinkTime:1e3},hard:{text:"\u0421\u043b\u043e\u0436\u043d\u043e \ud83d\ude35",skill:20,depth:22,thinkTime:3e3}},f=e=>{let{className:s,defaultPosition:t}=e;const r=(0,p.zy)(),f=(0,h.useMemo)((()=>new URLSearchParams(r.search)),[r.search]),M=(0,h.useMemo)((()=>new(d())),[]);t=(0,h.useMemo)((()=>t||f.get(g._.chessDefaultPosition)||M.fen()),[t,f,M]);const y=(0,h.useRef)(null),[w,b]=(0,h.useState)(t||f.get(g._.chessDefaultPosition)||M.fen()),[S,_]=(0,h.useState)("easy");function I(e){const s=M.move(e);return b(M.fen()),null!==s&&(M.game_over()||M.in_draw()?(m.R.checkmateSound.play(),!1):M.in_check()?(m.R.checkSound.play(),!0):"O-O-O"===s.san||"O-O"===s.san?(m.R.castlingSound.play(),!0):s.captured?(m.R.captureSound.play(),!0):(m.R.moveSound.play(),!0))}(0,h.useEffect)((()=>{y.current&&y.current.terminate();const e=new l;y.current=e;const s=v[S];return e.setLimitStrength(!1),e.setSkillLevel(s.skill),e.setDepth(s.depth),e.setThinkTime(s.thinkTime),s.elo&&e.setLimitStrength(!0,s.elo),s.threads&&e.setThreads(s.threads),s.multiPV&&e.setMultiPV(s.multiPV),console.log("Stockfish \u0443\u0440\u043e\u0432\u0435\u043d\u044c: ".concat(S),s),()=>{e.terminate(),y.current=null}}),[S]),(0,h.useEffect)((()=>{M.load(t)}),[t,M]);const C=e=>{console.log("[React \u2190 EngineMessage]",e);const s=y.current;if(s&&e.bestMove){const t=e.bestMove,i=I({from:t.substring(0,2),to:t.substring(2,4),promotion:t.length>4?t.substring(4,5):void 0});s.removeMessageListener(C),i||s.stop()}};return(0,k.jsx)("div",{className:(0,i.x)(o,{},[s||""]),children:(0,k.jsxs)("div",{className:n,children:[(0,k.jsx)("div",{className:a,children:Object.entries(v).map((e=>{let[s,t]=e;return(0,k.jsx)(c.$n,{onClick:()=>_(s),theme:c.Ox.CLASSIC,active:S===s,children:t.text},s)}))}),(0,k.jsx)(u.Ve,{id:"PlayVsStockfish",position:w,onPieceDrop:function(e,s,t){console.log("[Player move] ".concat(e," \u2192 ").concat(s),t);const i=I({from:e,to:s,promotion:t[1].toLowerCase()});return i&&setTimeout((()=>{!async function(){const e=y.current;if(e){e.addMessageListener(C),console.log("\u0417\u0430\u043f\u0440\u043e\u0441 \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u0445\u043e\u0434\u0430\u2026");try{await e.evaluatePosition(M.fen())}catch(s){throw e.removeMessageListener(C),s}}}()}),500),i}}),(0,k.jsxs)("div",{className:a,children:[(0,k.jsx)(c.$n,{onClick:()=>{M.reset(),b(M.fen())},children:"\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430"}),(0,k.jsx)(c.$n,{onClick:()=>{M.undo(),M.undo(),b(M.fen())},children:"\u041d\u0430\u0437\u0430\u0434"})]})]})})},M=e=>{let{className:s}=e;return(0,k.jsx)("div",{children:(0,k.jsx)(f,{})})}}}]);
//# sourceMappingURL=490.bcf0403e.chunk.js.map